<!-- 节拍器主页面 -->
<view class="container {{isPlaying ? 'playing' : ''}}">
  <!-- BPM圆形控制块 -->
  <view class="bpm-circle {{isPlaying ? 'playing' : ''}} {{tapTempoEnabled ? 'tap-tempo-mode' : ''}}" 
        bind:touchstart="onTouchStart" 
        bind:touchmove="onTouchMove" 
        bind:touchend="onTouchEnd"
        bind:tap="onCircleTap">
    <view class="bpm-value">{{bpm}}</view>
    <view class="bpm-label">{{tapTempoEnabled ? (tapTempoCount > 0 ? tapTempoCount + '次点击' : '点击设置速度') : 'BPM'}}</view>
  </view>

  <!-- 拍子显示区域 -->
  <view class="beats-container">
    <block wx:for="{{beats}}" wx:key="index">
      <view class="beat-column {{item.type}} {{item.active ? 'active' : ''}} {{item.disabled ? 'disabled' : ''}}" 
            data-index="{{index}}" 
            bind:tap="{{!item.disabled ? 'onBeatTap' : ''}}">
        <view class="beat-inner"></view>
      </view>
    </block>
  </view>

  <!-- 节拍模式选择 -->
  <view class="beat-patterns">
    <view class="pattern {{timeSignature === '4/4' ? 'active' : ''}}" 
          data-pattern="4/4" 
          bind:tap="changeTimeSignature">4/4</view>
    <view class="pattern {{timeSignature === '3/4' ? 'active' : ''}}" 
          data-pattern="3/4" 
          bind:tap="changeTimeSignature">3/4</view>
    <view class="pattern {{timeSignature === '6/8' ? 'active' : ''}}" 
          data-pattern="6/8" 
          bind:tap="changeTimeSignature">6/8</view>
  </view>

  <!-- 底部控制区域 -->
  <view class="bottom-controls">
    <!-- Tap Tempo 按钮 -->
    <view class="tap-tempo-btn {{tapTempoEnabled ? 'active' : ''}}" bindtap="toggleTapTempo">
      <view class="tap-tempo-icon"></view>
      <text>点击测速</text>
    </view>
    
    <!-- 音色选择悬浮按钮 -->
    <view class="floating-sound-btn" bindtap="showSoundPicker">
      <view class="sound-icon">
        <view class="icon-wave"></view>
        <view class="icon-wave"></view>
        <view class="icon-wave"></view>
      </view>
    </view>
  </view>

  <!-- 音色选择器组件 -->
  <sound-picker
    visible="{{showSoundPicker}}"
    sounds="{{sounds}}"
    sound-categories="{{soundCategories}}"
    current-sound="{{currentSound}}"
    bind:close="onSoundPickerClose"
    bind:select="onSoundSelect"
    bind:test="onSoundTest"
  />
</view> 