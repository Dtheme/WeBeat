<!-- 节拍器主页面 -->
<view class="container {{isPlaying ? 'playing' : ''}}">
  <!-- BPM圆形控制块 -->
  <view class="bpm-circle {{isPlaying ? 'playing' : ''}}" 
        bind:touchstart="onTouchStart" 
        bind:touchmove="onTouchMove" 
        bind:touchend="onTouchEnd"
        bind:tap="onCircleTap">
    <view class="bpm-value">{{bpm}}</view>
    <view class="bpm-label">BPM</view>
  </view>

  <!-- 拍子显示区域 -->
  <view class="beats-container">
    <block wx:for="{{beats}}" wx:key="index">
      <view class="beat-column {{item.type}} {{item.active ? 'active' : ''}} {{item.disabled ? 'disabled' : ''}}" 
            data-index="{{index}}" 
            bind:tap="{{!item.disabled ? 'onBeatTap' : ''}}">
        <view class="beat-inner"></view>
      </view>
    </block>
  </view>

  <!-- 节拍模式选择 -->
  <view class="beat-patterns">
    <view class="pattern {{timeSignature === '4/4' ? 'active' : ''}}" 
          data-pattern="4/4" 
          bind:tap="changeTimeSignature">4/4</view>
    <view class="pattern {{timeSignature === '3/4' ? 'active' : ''}}" 
          data-pattern="3/4" 
          bind:tap="changeTimeSignature">3/4</view>
    <view class="pattern {{timeSignature === '6/8' ? 'active' : ''}}" 
          data-pattern="6/8" 
          bind:tap="changeTimeSignature">6/8</view>
  </view>

  <!-- 音色选择区域 -->
  <view class="sound-picker">
    <view class="sound-title">音色</view>
    <scroll-view 
      scroll-x 
      class="sound-list" 
      enhanced="{{true}}" 
      show-scrollbar="{{false}}" 
      enable-flex="{{true}}"
      bounces="{{true}}"
      scroll-with-animation="{{true}}"
    >
      <view class="sound-list-inner">
        <block wx:for="{{sounds}}" wx:key="id">
          <view 
            class="sound-item {{currentSound === item.id ? 'active' : ''}}"
            data-sound="{{item.id}}"
            bind:tap="changeSound"
          >
            {{item.name}}
          </view>
        </block>
      </view>
    </scroll-view>
  </view>

  <!-- 音频测试按钮 -->
  <view class="test-sound-btn {{testingSound ? 'playing' : ''}}" bind:tap="testCurrentSound">
    <view class="test-sound-icon"></view>
  </view>

  <!-- 添加音色选择按钮 -->
  <view class="sound-select-btn" bindtap="showSoundPicker">
    <text class="current-sound">{{currentSoundName}}</text>
    <text class="icon">▼</text>
  </view>

  <!-- 音色选择器组件 -->
  <sound-picker
    visible="{{showSoundPicker}}"
    sounds="{{sounds}}"
    soundCategories="{{soundCategories}}"
    currentSound="{{currentSound}}"
    bind:select="onSoundSelect"
    bind:test="onSoundTest"
    bind:close="onSoundPickerClose"
  />
</view> 