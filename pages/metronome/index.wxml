<!-- 节拍器主页面 -->
<view class="container {{isPlaying ? 'playing' : ''}}">
  <!-- BPM圆形控制块 -->
  <view class="bpm-circle {{isPlaying ? 'playing' : ''}} {{tapTempoEnabled ? 'tap-tempo-mode' : ''}}" 
        bind:touchstart="onTouchStart" 
        bind:touchmove="onTouchMove" 
        bind:touchend="onTouchEnd"
        bind:tap="onCircleTap">
    <view class="bpm-value">{{bpm}}</view>
    <view class="bpm-label">{{tapTempoEnabled ? '点击测试速度' : 'BPM'}}</view>
  </view>

  <!-- 拍子显示区域 -->
  <view class="beats-container">
    <block wx:for="{{beats}}" wx:key="index">
      <view class="beat-column {{item.type}} {{item.active ? 'active' : ''}} {{item.disabled ? 'disabled' : ''}}" 
            data-index="{{index}}" 
            bind:tap="{{!item.disabled ? 'onBeatTap' : ''}}">
        <view class="beat-inner"></view>
      </view>
    </block>
  </view>

  <!-- BPM控制条 -->
  <view class="bpm-control-container">
    <view class="bpm-minus-btn" bindtap="decreaseBpm" bindlongpress="startDecreaseBpm" bindtouchend="stopBpmChange"></view>
    <view class="bpm-slider">
      <view class="bpm-slider-bar">
        <view class="bpm-slider-fill" style="width: {{(bpm - minBpm) / (maxBpm - minBpm) * 100}}%"></view>
        <view class="bpm-slider-handle {{isSnapping ? 'snapping' : ''}}" 
              style="left: {{(bpm - minBpm) / (maxBpm - minBpm) * 100}}%"
              bind:touchstart="onSliderTouchStart"
              bind:touchmove="onSliderTouchMove"
              bind:touchend="onSliderTouchEnd">
        </view>
      </view>
    </view>
    <view class="bpm-plus-btn" bindtap="increaseBpm" bindlongpress="startIncreaseBpm" bindtouchend="stopBpmChange"></view>
  </view>

  <!-- 节拍模式选择 -->
  <view class="beat-patterns">
    <view class="pattern {{timeSignature === '4/4' ? 'active' : ''}}" 
          data-pattern="4/4" 
          bind:tap="changeTimeSignature">4/4</view>
    <view class="pattern {{timeSignature === '3/4' ? 'active' : ''}}" 
          data-pattern="3/4" 
          bind:tap="changeTimeSignature">3/4</view>
    <view class="pattern {{timeSignature === '6/8' ? 'active' : ''}}" 
          data-pattern="6/8" 
          bind:tap="changeTimeSignature">6/8</view>
  </view>

  <!-- 底部控制区域 -->
  <view class="bottom-controls">
    <!-- 播放/暂停按钮 -->
    <view class="play-pause-btn" bindtap="togglePlay">
      <view class="{{isPlaying ? 'pause-icon' : 'play-icon'}}"></view>
    </view>
  </view>

  <!-- 右下角浮动按钮组 -->
  <view class="floating-buttons">
    <!-- 浮动菜单组件 -->
    <view class="floating-menu {{isMenuExpanded ? 'expanded' : ''}}">
      <view class="menu-items">
        <view class="menu-item sound-style-item tempo-item {{tapTempoEnabled ? 'active' : ''}}" bindtap="toggleTapTempo">
          <text>测速模式</text>
          <view class="sound-icon">
            <view class="icon-wave"></view>
            <view class="icon-wave"></view>
            <view class="icon-wave"></view>
          </view>
        </view>
        <view class="menu-item sound-style-item sound-item" bindtap="showSoundPicker">
          <text>音色选择</text>
          <view class="sound-icon">
            <view class="icon-wave"></view>
            <view class="icon-wave"></view>
            <view class="icon-wave"></view>
          </view>
        </view>
        <view class="menu-item sound-style-item settings-item" bindtap="onSettingsTap">
          <text>设置</text>
          <view class="sound-icon">
            <view class="icon-wave"></view>
            <view class="icon-wave"></view>
            <view class="icon-wave"></view>
          </view>
        </view>
        <view class="menu-item sound-style-item about-item" bindtap="onAboutTap">
          <text>关于</text>
          <view class="sound-icon">
            <view class="icon-wave"></view>
            <view class="icon-wave"></view>
            <view class="icon-wave"></view>
          </view>
        </view>
      </view>
      <view class="menu-toggle" bindtap="toggleMenu">
        <view class="menu-icon"></view>
      </view>
    </view>
  </view>

  <!-- 音色选择器组件 -->
  <sound-picker
    visible="{{showSoundPicker}}"
    sounds="{{sounds}}"
    sound-categories="{{soundCategories}}"
    current-sound="{{currentSound}}"
    bind:close="onSoundPickerClose"
    bind:select="onSoundSelect"
    bind:test="onSoundTest"
  />
</view> 